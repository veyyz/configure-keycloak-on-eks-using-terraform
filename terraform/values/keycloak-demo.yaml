replicaCount: 1

image:
  tag: "${keycloak_image_tag}"

proxy: edge
hostname: "${keycloak_hostname}"
hostnameStrict: true
hostnameStrictHttps: true

auth:
  existingSecret: "${keycloak_admin_secret_name}"
  existingSecretUserKey: "username"
  existingSecretPasswordKey: "password"

extraEnvVars:
  - name: KC_HEALTH_ENABLED
    value: "true"
  - name: KC_METRICS_ENABLED
    value: "true"

service:
  type: ClusterIP
  ports:
    http: 8080

externalDatabase:
  host: "${db_hostname}"
  user: "${db_username}"
  database: "${database_name}"
  port: 3306
  existingSecret: "${keycloak_db_secret_name}"
  existingSecretPasswordKey: "password"

ingress:
  enabled: true
  ingressClassName: "alb"
  hostname: "${keycloak_hostname}"
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/certificate-arn: "${cert_arn}"
    alb.ingress.kubernetes.io/ssl-redirect: '443'
    alb.ingress.kubernetes.io/ssl-policy: ELBSecurityPolicy-TLS13-1-2-2021-06
    alb.ingress.kubernetes.io/group.name: keycloak-demo
    alb.ingress.kubernetes.io/load-balancer-attributes: "access_logs.s3.enabled=true,access_logs.s3.bucket=${alb_log_bucket},access_logs.s3.prefix=${alb_log_prefix}"
  tls: false

resources:
  requests:
    cpu: 200m
    memory: 512Mi
  limits:
    cpu: 500m
    memory: 1Gi

livenessProbe:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 15

readinessProbe:
  enabled: true
  initialDelaySeconds: 20
  periodSeconds: 10
